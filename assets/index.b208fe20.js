var F=Object.defineProperty;var P=(i,t,e)=>t in i?F(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var s=(i,t,e)=>(P(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();const u=5e3;class h{constructor(t=!1){s(this,"mascot");s(this,"next");this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.setFrame(this.getFrame())}destroy(){}}class g{constructor(t,e=250){s(this,"frames",[]);s(this,"intervalId",0);this.interval=e,this.frames=t.split(" ")}init(t){let e=0;this.intervalId=setInterval(()=>{e<this.frames.length&&(t.canvas.setFrame(`shime${this.frames[e]}.png`),e++)},this.interval)}destroy(){this.intervalId&&clearInterval(this.intervalId)}}class N extends h{constructor(){super(...arguments);s(this,"name","idle fish");s(this,"requestID",0)}init(e){super.init(e),e.canvas.reversed=this.isRight,e.canvas.flushPosition()}destroy(){clearTimeout(this.requestID),this.mascot.canvas.reversed=!1,this.mascot.canvas.flushPosition()}generateNext(){this.next=new m,this.requestID=setTimeout(()=>{this.mascot.setAnimation(this.next)},2e3)}getFrame(){return"shime20.png"}}class D extends h{constructor(){super(...arguments);s(this,"name","idle point");s(this,"requestID",0)}generateNext(){this.next=new m,this.requestID=setTimeout(()=>{this.mascot.setAnimation(this.next)},1500)}getFrame(){return"shime37.png"}}class f extends h{constructor(){super(...arguments);s(this,"name","idle sits on tchat");s(this,"requestID",0);s(this,"secondFrame",0)}init(e){super.init(e),this.mascot.canvas.translateOffset.y=14,this.mascot.canvas.flushPosition(),this.secondFrame=setTimeout(()=>{this.mascot.canvas.setFrame("shime31.png")},1e3)}destroy(){super.destroy(),clearTimeout(this.requestID),clearTimeout(this.secondFrame),this.mascot.canvas.translateOffset.y=0,this.mascot.canvas.flushPosition()}generateNext(){this.next=this.getNextAnim(),this.requestID=setTimeout(()=>{this.mascot.setAnimation(this.next)},u)}getFrame(){return"shime30.png"}getNextAnim(){return Math.random()>.5?new c:new T}}class T extends h{constructor(){super(...arguments);s(this,"name","idle sits tchat and move legs");s(this,"requestID",0);s(this,"intervalID",0);s(this,"destroyed",!1)}init(e){super.init(e),this.mascot.canvas.translateOffset.y=14,this.mascot.canvas.flushPosition();const n="31 32 31 33".split(" ");let a=0;this.intervalID=setInterval(()=>{this.destroyed||(this.mascot.canvas.setFrame(`shime${n[a]}.png`),a=(a+1)%n.length)},1500)}destroy(){this.destroyed=!0,clearTimeout(this.requestID),clearInterval(this.intervalID),this.mascot.canvas.translateOffset.y=0,this.mascot.canvas.flushPosition()}generateNext(){this.next=this.getNextAnim(),this.requestID=setTimeout(()=>{this.mascot.setAnimation(this.next)},15e3)}getFrame(){return"shime33.png"}getNextAnim(){return new f}}class c extends h{constructor(){super(...arguments);s(this,"name","idle sits");s(this,"requestID",0)}generateNext(){this.next=this.getNextAnim(),this.requestID=setTimeout(()=>{this.mascot.setAnimation(this.next)},u)}destroy(){super.destroy(),clearTimeout(this.requestID)}getFrame(){return"shime11.png"}getNextAnim(){if(Math.random()>.5)return new m;const e=[new R,new M,new O,new B,new f];return e[Math.floor(Math.random()*e.length)]}}class R extends h{constructor(){super(...arguments);s(this,"name","idle sits and bored");s(this,"requestID",0)}init(e){super.init(e),this.mascot.canvas.translateOffset.y=14,this.mascot.canvas.flushPosition()}destroy(){clearTimeout(this.requestID),this.mascot.canvas.translateOffset.y=0,this.mascot.canvas.flushPosition()}generateNext(){this.next=new c,this.requestID=setTimeout(()=>{this.mascot.setAnimation(this.next)},u)}getFrame(){return"shime30.png"}}class M extends h{constructor(){super(...arguments);s(this,"name","idle sits and look up");s(this,"requestID",0)}destroy(){super.destroy(),clearTimeout(this.requestID)}generateNext(){this.next=new c,this.requestID=setTimeout(()=>{this.mascot.setAnimation(this.next)},u)}getFrame(){return"shime26.png"}}class O extends h{constructor(){super(...arguments);s(this,"name","idle sits and sing");s(this,"requestID",0);s(this,"animation",new g("16 17 16 17 27 15",1200))}init(e){super.init(e),this.animation.init(e)}destroy(){super.destroy(),this.animation.destroy(),clearTimeout(this.requestID)}generateNext(){this.next=new c,this.requestID=setTimeout(()=>{this.mascot.setAnimation(this.next)},8200)}getFrame(){return"shime15.png"}}class B extends h{constructor(){super(...arguments);s(this,"name","idle sits and sticks tongue out");s(this,"requestID",0);s(this,"animation",new g("28 29 29 27",1e3))}init(e){super.init(e),this.animation.init(e)}destroy(){super.destroy(),this.animation.destroy(),clearTimeout(this.requestID)}generateNext(){this.next=new c,this.requestID=setTimeout(()=>{this.mascot.setAnimation(this.next)},5e3)}getFrame(){return"shime27.png"}}class E extends h{constructor(){super(...arguments);s(this,"name","idle smug");s(this,"animation",new g("39 40",500));s(this,"requestID",0)}init(e){super.init(e),this.animation.init(e)}destroy(){super.destroy(),this.animation.destroy()}generateNext(){this.next=new m,this.requestID=setTimeout(()=>{this.mascot.setAnimation(this.next)},1500)}getFrame(){return"shime38.png"}}class m{constructor(t=!1){s(this,"name","idle normal");s(this,"mascot");s(this,"next");s(this,"requestId",0);this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.setFrame("shime1.png")}destroy(){clearTimeout(this.requestId)}generateNext(){this.next=this.getNextStandupAnim(),this.requestId=setTimeout(()=>{this.mascot.setAnimation(this.next)},1e3)}getNextStandupAnim(){const t=[new E,new D,new N(this.isRight),new f];return Math.random()>.75?new c:(Math.random()>.6&&(this.mascot.canvas.position.y-=20,this.mascot.canvas.flushPosition(),this.mascot.setBehavior(new v({x:Math.random()>.5?-20:20,y:-20}))),t[Math.floor(Math.random()*t.length)])}}class I{constructor(t=!1){s(this,"name","thrown fly normal");s(this,"mascot");s(this,"next");this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.reversed=this.isRight,this.mascot.canvas.setFrame("shime22.png")}destroy(){}generateNext(){this.next=new L(this.isRight)}}class L{constructor(t=!1){s(this,"name","thrown fly bump floor");s(this,"mascot");s(this,"next");s(this,"requestId",0);s(this,"intervalId",0);this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.reversed=this.isRight;const e="19 18".split(" ");let n=0;this.intervalId=setInterval(()=>{n<e.length&&(this.mascot.canvas.setFrame(`shime${e[n]}.png`),n++)},250),this.mascot.canvas.setFrame("shime18.png")}destroy(){this.requestId&&clearTimeout(this.requestId),this.intervalId&&clearInterval(this.intervalId)}generateNext(){this.next=new m(this.isRight),this.requestId=setTimeout(()=>{this.mascot.setAnimation(this.next)},1200)}}class b extends h{constructor(){super(...arguments);s(this,"name","idle climb horiz");s(this,"requestID",0)}init(e){super.init(e),this.isRight&&(this.mascot.canvas.reversed=!0)}destroy(){clearTimeout(this.requestID)}generateNext(){Math.random()>.5?this.next=new x(this.isRight):this.next=this,this.requestID=setTimeout(()=>{this.mascot.setAnimation(this.next)},1e3)}getFrame(){return"shime13.png"}}class x extends b{constructor(){super(...arguments);s(this,"name","idle climb horiz move up");s(this,"animation",new g("14 13 12 12",500))}init(e){super.init(e),this.animation.init(e)}destroy(){super.destroy(),this.animation.destroy()}generateNext(){Math.random()>.5?this.next=new x(this.isRight):this.next=this,this.requestID=setTimeout(()=>{if(Math.random()>.7){this.mascot.setAnimation(new I(this.isRight)),this.mascot.setBehavior(new v({x:this.isRight?-20:20,y:-20}));return}this.mascot.setAnimation(this.next)},2500)}}class S{constructor(t=!1){s(this,"name","thrown fall normal");s(this,"mascot");s(this,"next");this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.reversed=this.isRight,this.mascot.canvas.setFrame("shime4.png")}destroy(){}generateNext(){this.next=new k(this.isRight)}}class k{constructor(t=!1){s(this,"name","thrown fall bump floor");s(this,"mascot");s(this,"next");s(this,"requestId",0);this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.reversed=this.isRight,this.mascot.canvas.setFrame("shime45.png")}destroy(){this.requestId&&clearTimeout(this.requestId)}generateNext(){this.next=new m(this.isRight),this.requestId=setTimeout(()=>{this.mascot.setAnimation(this.next)},350)}}class d{constructor(t,e,n,a){s(this,"right");s(this,"bottom");this.top=t,this.left=e,this.width=n,this.height=a,this.right=e+n,this.bottom=t+a}static fromElement(t){return new d(t.offsetTop,t.offsetLeft,t.offsetWidth,t.offsetHeight)}}class X{constructor(){s(this,"mascot");s(this,"screenRects");s(this,"resizeObserver")}init(t){this.mascot=t,this.onUpdate(),this.resizeObserver=new ResizeObserver(this.onUpdate.bind(this)),this.resizeObserver.observe(this.mascot.container)}destroy(){this.resizeObserver.disconnect()}onUpdate(){const t=this.screenRects?{...this.screenRects}:new d(0,0,0,0),e=this.mascot.container;this.screenRects=d.fromElement(e),(this.screenRects.width<t.width||this.screenRects.height<t.height)&&this.mascot.flushPosition(),console.info("%c[shimejis - Environment]","font-weight: bold;","updated screen rects",this.screenRects)}getCollisionStatus(t){const e=this.mascot.environment.screenRects.bottom-this.mascot.canvas.canvas.height,n=this.mascot.environment.screenRects.right-this.mascot.canvas.canvas.width,a=this.mascot.canvas.canvas.width/2;let o=r.None,l={...t};return t.x-a>n||t.x+a<=0?o=r.Wall:t.y>e&&(o=r.Floor),{status:o,newPosition:l}}}var r=(i=>(i[i.None=0]="None",i[i.Wall=1]="Wall",i[i.Floor=2]="Floor",i[i.Chat=3]="Chat",i))(r||{});class p{constructor(t){s(this,"name","grabbed normal");s(this,"mascot");s(this,"next");s(this,"isRight");s(this,"requestId");this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.setFrame(this.getFrame())}destroy(){this.requestId&&clearTimeout(this.requestId)}generateNext(){}getFrame(){return"shime1.png"}}class z extends p{constructor(){super(...arguments);s(this,"name","grabbed fast")}getFrame(){return this.isRight?"shime10.png":"shime9.png"}generateNext(){this.next=new q(this.isRight),this.requestId=setTimeout(()=>{this.mascot.setAnimation(this.next)},500)}}class q extends p{constructor(){super(...arguments);s(this,"name","grabbed slow")}getFrame(){return this.isRight?"shime8.png":"shime7.png"}generateNext(){this.next=new p(this.isRight),this.requestId=setTimeout(()=>{this.mascot.setAnimation(this.next)},350)}}class A{constructor(t){s(this,"name","grabbed");s(this,"mascot");s(this,"clickOffset");s(this,"lastPosition");s(this,"listener");s(this,"alreadyChangedBehavior",!1);this.lastPosition=t}init(t){this.mascot=t,this.listener=this.handlePointerMove.bind(this),this.mascot.container.addEventListener("pointermove",this.listener),this.mascot.canvas.reversed=!1,this.clickOffset={x:this.lastPosition.x-this.mascot.canvas.position.x,y:this.lastPosition.y-this.mascot.canvas.position.y}}destroy(){this.mascot.container.removeEventListener("pointermove",this.listener)}handlePointerMove(t){const e={x:t.clientX-this.lastPosition.x,y:t.clientY-this.lastPosition.y};if(t.pressure<.5){this.makeThrown(t,e);return}this.lastPosition={x:t.clientX,y:t.clientY},this.useGrabbedAnimation(e),this.mascot.canvas.position.x=t.clientX-this.clickOffset.x,this.mascot.canvas.position.y=t.clientY-this.clickOffset.y,this.mascot.flushPosition()}useGrabbedAnimation(t){const e=t.x<0,n=Math.abs(t.x);n>5?this.mascot.setAnimation(new z(e)):n>3&&this.mascot.setAnimation(new q(e))}makeThrown(t,e){this.alreadyChangedBehavior||(this.alreadyChangedBehavior=!0,this.lastPosition.x===0&&this.lastPosition.y===0&&(this.lastPosition.x=t.clientX,this.lastPosition.y=t.clientY),this.mascot.setBehavior(new v(e)))}}class C{constructor(){s(this,"name","idle");s(this,"mascot");s(this,"listener")}init(t){this.mascot=t,this.listener=this.handlePointerDown.bind(this),this.mascot.canvas.canvas.addEventListener("pointerdown",this.listener)}destroy(){this.mascot.canvas.canvas.removeEventListener("pointerdown",this.listener)}handlePointerDown(t){this.mascot.canvas.setFrame("shime01.png"),this.mascot.setBehavior(new A({x:t.clientX,y:t.clientY}))}}class v{constructor(t){s(this,"name","thrown");s(this,"mascot");s(this,"listener");s(this,"lastUpdate",0);s(this,"requestID",0);s(this,"velocity");s(this,"acceleration_y");s(this,"currentAnimation");t.x=w(t.x,-50,50)*10,t.y=w(t.y,-50,1)*10,Math.abs(t.x)<30&&(t.x=0),this.velocity=t,this.acceleration_y=500}init(t){this.mascot=t,this.listener=this.handlePointerDown.bind(this),this.mascot.canvas.canvas.addEventListener("pointerdown",this.listener),this.velocity.x===0?this.currentAnimation=new S:this.currentAnimation=new I(this.velocity.x>0),this.mascot.setAnimation(this.currentAnimation),this.requestID=window.requestAnimationFrame(this.update.bind(this))}update(t){const e=Math.min(t-this.lastUpdate,100)*.001;this.lastUpdate=t,this.velocity.y=this.velocity.y+this.acceleration_y*e;const n=this.mascot.canvas.position;n.y=n.y+this.velocity.y*e,n.x=n.x+this.velocity.x*e;const{status:a,newPosition:o}=this.mascot.environment.getCollisionStatus(n);if(a===r.None){this.mascot.flushPosition(),this.requestID=window.requestAnimationFrame(this.update.bind(this));return}n.x=o.x,n.y=o.y,a===r.Wall&&(this.currentAnimation.next=new b(this.velocity.x>0)),this.onStop()}onStop(){this.mascot.flushPosition(),this.mascot.setBehavior(new C),this.mascot.setAnimation(this.currentAnimation.next)}destroy(){this.mascot.canvas.canvas.removeEventListener("pointerdown",this.listener),window.cancelAnimationFrame(this.requestID)}handlePointerDown(t){this.mascot.canvas.setFrame("shime01.png"),this.mascot.setBehavior(new A({x:t.clientX,y:t.clientY}))}}function w(i,t,e){return Math.max(Math.min(i,e),t)}const U=["shime01.png","shime1.png","shime2.png","shime3.png","shime4.png","shime5.png","shime6.png","shime7.png","shime8.png","shime9.png","shime10.png","shime11.png","shime12.png","shime13.png","shime14.png","shime15.png","shime16.png","shime17.png","shime18.png","shime19.png","shime20.png","shime21.png","shime22.png","shime23.png","shime24.png","shime25.png","shime26.png","shime27.png","shime28.png","shime29.png","shime30.png","shime31.png","shime32.png","shime33.png","shime34.png","shime35.png","shime36.png","shime37.png","shime38.png","shime39.png","shime40.png","shime41.png","shime42.png","shime43.png","shime44.png","shime45.png","shime46.png"];class Y{constructor(){s(this,"image",{})}async load(){const t=U.map(e=>new Promise(n=>{const a=new Image;a.onload=()=>{n(a)},a.src=`./img/${e}`,this.image[e]=a}));await Promise.all(t)}get(t){if(!this.image[t])throw new Error(`image not found: ${t}`);return this.image[t]}}class y{constructor(t,e){s(this,"canvas");s(this,"ctx");s(this,"images");s(this,"position",{x:0,y:0});s(this,"translateOffset",{x:0,y:0});s(this,"reversed",!1);this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.canvas.setAttribute("class","ene-shimeji"),this.updatePosition()}static async newInstance(t,e){const n=new y(128,128);return n.images=t,await n.images.load(),e.appendChild(n.canvas),n.initContext(),n}initContext(){const t=this.canvas.getContext("2d");if(!t)throw new Error("canvas context not found");this.ctx=t}setFrame(t){const e=this.images.get(t);this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(e,0,0)}updatePosition(t=0,e=0){this.position.x=t,this.position.y=e,this.flushPosition()}flushPosition(){const{x:t,y:e}=this.position;let n=`translate(${t+this.translateOffset.x}px, ${e+this.translateOffset.y}px)`;this.reversed&&(n+=" scaleX(-1)"),this.canvas.style.transform=n}}class ${constructor(){s(this,"canvas");s(this,"container");s(this,"animation");s(this,"behavior");s(this,"environment",new X)}async start(){this.initContainer(),this.canvas=await y.newInstance(new Y,this.container),this.environment.init(this),this.initMascotPosition()}stop(){}initContainer(){const t=document.getElementById("app");if(!t)throw new Error("app element not found");this.container=t}initMascotPosition(){this.canvas.position.x=this.environment.screenRects.width*.5-this.canvas.canvas.width*.5,this.flushPosition(),this.setBehavior(new v({x:0,y:0}))}setAnimation(t){this.animation&&this.animation.destroy(),this.animation=t,this.animation.init(this)}setBehavior(t){var e;((e=this.behavior)==null?void 0:e.name)!==t.name&&(this.behavior&&this.behavior.destroy(),this.behavior=t,this.behavior.init(this),this.canvas.canvas.dataset.behavior=this.behavior.name)}flushPosition(){const{top:t,left:e,right:n,bottom:a}=this.environment.screenRects,o={...this.canvas.position};return this.canvas.position.x<e-this.canvas.canvas.width*.5?this.canvas.position.x=e-this.canvas.canvas.width*.5:this.canvas.position.x>n-this.canvas.canvas.width*.5&&(this.canvas.position.x=n-this.canvas.canvas.width*.5),this.canvas.position.y<t?this.canvas.position.y=t:this.canvas.position.y+this.canvas.canvas.height>a&&(this.canvas.position.y=a-this.canvas.canvas.height),this.canvas.flushPosition(),o.x===this.canvas.position.x&&o.y===this.canvas.position.y}}const G={start(){console.info("%c[shimejis]","font-weight: bold","Plugin started."),new $().start()},stop(){console.info("%c[shimejis]","font-weight: bold","Plugin unloaded.")}};document.addEventListener("DOMContentLoaded",()=>{G.start()});
