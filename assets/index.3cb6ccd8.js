var N=Object.defineProperty;var T=(i,t,s)=>t in i?N(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var e=(i,t,s)=>(T(i,typeof t!="symbol"?t+"":t,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();const f=5e3;class h{constructor(t=!1){e(this,"mascot");e(this,"next");this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.setFrame(this.getFrame())}destroy(){}}class w{constructor(t,s=250){e(this,"frames",[]);e(this,"intervalId",0);this.interval=s,this.frames=t.split(" ")}init(t){let s=0;this.intervalId=window.setInterval(()=>{s<this.frames.length&&(t.canvas.setFrame(`shime${this.frames[s]}.png`),s++)},this.interval)}destroy(){this.intervalId&&clearInterval(this.intervalId)}}const q=class{constructor(t=!1){e(this,"name","thrown fly normal");e(this,"mascot");e(this,"next");this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.reversed=this.isRight,this.mascot.canvas.setFrame(q.poissonMode?"enepoisson.png":"shime22.png")}destroy(){}generateNext(){this.next=new E(this.isRight)}};let d=q;e(d,"poissonMode",!1);class E{constructor(t=!1){e(this,"name","thrown fly bump floor");e(this,"mascot");e(this,"next");e(this,"requestId",0);e(this,"intervalId",0);this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.reversed=this.isRight;const s="19 18".split(" ");let n=0;this.intervalId=window.setInterval(()=>{n<s.length&&(this.mascot.canvas.setFrame(`shime${s[n]}.png`),n++)},250),this.mascot.canvas.setFrame("shime18.png")}destroy(){this.requestId&&clearTimeout(this.requestId),this.intervalId&&clearInterval(this.intervalId)}generateNext(){this.next=new r(this.isRight),this.requestId=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},1200)}}class P extends h{constructor(){super(...arguments);e(this,"name","idle climb horiz");e(this,"requestID",0)}init(s){super.init(s),this.isRight&&(this.mascot.canvas.reversed=!0)}destroy(){clearTimeout(this.requestID)}generateNext(){Math.random()>.5?this.next=new y(this.isRight):this.next=this,this.requestID=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},1e3)}getFrame(){return"shime13.png"}}class y extends P{constructor(){super(...arguments);e(this,"name","idle climb horiz move up");e(this,"animation",new w("14 13 12 12",500))}init(s){super.init(s),this.animation.init(s)}destroy(){super.destroy(),this.animation.destroy()}generateNext(){Math.random()>.5?this.next=new y(this.isRight):this.next=this,this.requestID=window.setTimeout(()=>{if(Math.random()>.7){this.mascot.setAnimation(new d(this.isRight)),this.mascot.setBehavior(new v({x:this.isRight?-20:20,y:-20}));return}this.mascot.setAnimation(this.next)},2500)}}class M{constructor(t=!1){e(this,"name","thrown fall normal");e(this,"mascot");e(this,"next");this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.reversed=this.isRight,this.mascot.canvas.setFrame("shime4.png")}destroy(){}generateNext(){this.next=new O(this.isRight)}}class O{constructor(t=!1){e(this,"name","thrown fall bump floor");e(this,"mascot");e(this,"next");e(this,"requestId",0);this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.reversed=this.isRight,this.mascot.canvas.setFrame("shime45.png")}destroy(){this.requestId&&clearTimeout(this.requestId)}generateNext(){this.next=new r(this.isRight),this.requestId=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},350)}}const l=class{constructor(){e(this,"isDiscord",!1);document.location.href.includes("discord")&&(this.isDiscord=!0)}static getInstance(){return l.instance||(l.instance=new l),l.instance}getApp(){let t;if(this.isDiscord?t=document.querySelector("body>div"):t=document.getElementById("app"),!t)throw new Error("app element not found");return t}getEnvElement(){let t;if(this.isDiscord){const s=document.querySelector("nav");if(!s)throw new Error("Servers list not found");t=s.nextElementSibling,console.log(t)}else t=document.getElementById("app");if(!t)throw new Error("env element not found");return t}attachEasterEgg(t){this.isDiscord||(window.poisson=t)}detachEasterEgg(){window.poisson&&delete window.poisson}};let c=l;e(c,"instance",null);class p{constructor(t,s,n,a){e(this,"right");e(this,"bottom");this.top=t,this.left=s,this.width=n,this.height=a,this.right=s+n,this.bottom=t+a}static fromElement(t){const s=t.getBoundingClientRect();return new p(s.top,s.left,s.width,s.height)}}class L{constructor(){e(this,"mascot");e(this,"screenRects");e(this,"canvasRect",{width:0,height:0});e(this,"resizeObserver")}init(t){this.mascot=t,this.onUpdate(),this.resizeObserver=new ResizeObserver(this.onUpdate.bind(this)),this.resizeObserver.observe(this.mascot.container),this.canvasRect={width:this.mascot.canvas.canvas.width,height:this.mascot.canvas.canvas.height}}destroy(){this.resizeObserver.disconnect()}onUpdate(){const t=this.screenRects?{...this.screenRects}:new p(0,0,0,0),s=c.getInstance().getEnvElement();this.screenRects=p.fromElement(s),(this.screenRects.width<t.width||this.screenRects.height<t.height)&&this.mascot.flushPosition(),console.info("%c[shimejis - Environment]","font-weight: bold;","updated screen rects",this.screenRects)}getCollisionStatus(t){const s=this.screenRects.bottom-this.canvasRect.height,n=this.screenRects.right-this.canvasRect.width,a=this.canvasRect.width*.5;let o=u.None,m={...t};return t.x-a>n||t.x+a<=this.screenRects.left?o=u.Wall:t.y>s&&(o=u.Floor),{status:o,newPosition:m}}}var u=(i=>(i[i.None=0]="None",i[i.Wall=1]="Wall",i[i.Floor=2]="Floor",i[i.Chat=3]="Chat",i))(u||{});class x{constructor(t){e(this,"name","grabbed normal");e(this,"mascot");e(this,"next");e(this,"isRight");e(this,"requestId");this.isRight=t}init(t){this.mascot=t,this.generateNext(),this.mascot.canvas.setFrame(this.getFrame())}destroy(){this.requestId&&clearTimeout(this.requestId)}generateNext(){}getFrame(){return"shime1.png"}}class B extends x{constructor(){super(...arguments);e(this,"name","grabbed fast")}getFrame(){return this.isRight?"shime10.png":"shime9.png"}generateNext(){this.next=new R(this.isRight),this.requestId=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},500)}}class R extends x{constructor(){super(...arguments);e(this,"name","grabbed slow")}getFrame(){return this.isRight?"shime8.png":"shime7.png"}generateNext(){this.next=new x(this.isRight),this.requestId=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},350)}}class F{constructor(t){e(this,"name","grabbed");e(this,"mascot");e(this,"clickOffset");e(this,"lastPosition");e(this,"lastDelta");e(this,"listener");e(this,"listenerLeave");e(this,"alreadyChangedBehavior",!1);this.lastPosition=t,this.lastDelta={x:0,y:0}}init(t){this.mascot=t,this.listener=this.handlePointerMove.bind(this),this.listenerLeave=this.handleThrown.bind(this),this.mascot.container.addEventListener("pointermove",this.listener),this.mascot.container.addEventListener("pointerup",this.listenerLeave),this.mascot.canvas.reversed=!1,this.clickOffset={x:this.lastPosition.x-this.mascot.canvas.position.x,y:this.lastPosition.y-this.mascot.canvas.position.y}}destroy(){this.mascot.container.removeEventListener("pointermove",this.listener),this.mascot.container.removeEventListener("pointerup",this.listenerLeave)}handleThrown(t){this.makeThrown(t,this.lastDelta)}handlePointerMove(t){if(this.alreadyChangedBehavior)return;const s={x:t.clientX-this.lastPosition.x,y:t.clientY-this.lastPosition.y};this.lastPosition={x:t.clientX,y:t.clientY},this.lastDelta=s,this.useGrabbedAnimation(s),this.mascot.canvas.position.x=t.clientX-this.clickOffset.x,this.mascot.canvas.position.y=t.clientY-this.clickOffset.y,this.mascot.flushPosition()}useGrabbedAnimation(t){const s=t.x<0,n=Math.abs(t.x);n>5?this.mascot.setAnimation(new B(s)):n>3&&this.mascot.setAnimation(new R(s))}makeThrown(t,s){this.alreadyChangedBehavior||(this.alreadyChangedBehavior=!0,this.lastPosition.x===0&&this.lastPosition.y===0&&(this.lastPosition.x=t.clientX,this.lastPosition.y=t.clientY),this.mascot.setBehavior(new v(s)))}}class S{constructor(){e(this,"name","idle");e(this,"mascot");e(this,"listener")}init(t){this.mascot=t,this.listener=this.handlePointerDown.bind(this),this.mascot.canvas.canvas.addEventListener("pointerdown",this.listener)}destroy(){this.mascot.canvas.canvas.removeEventListener("pointerdown",this.listener)}handlePointerDown(t){this.mascot.canvas.setFrame("shime01.png"),this.mascot.setBehavior(new F({x:t.clientX,y:t.clientY}))}}class v{constructor(t){e(this,"name","thrown");e(this,"mascot");e(this,"listener");e(this,"lastUpdate",0);e(this,"requestID",0);e(this,"velocity");e(this,"acceleration_y");e(this,"currentAnimation");t.x=D(t.x,-50,50)*10,t.y=D(t.y,-50,1)*10,Math.abs(t.x)<30&&(t.x=0),this.velocity=t,this.acceleration_y=500}init(t){this.mascot=t,this.listener=this.handlePointerDown.bind(this),this.mascot.canvas.canvas.addEventListener("pointerdown",this.listener),this.velocity.x===0?this.currentAnimation=new M:this.currentAnimation=new d(this.velocity.x>0),this.mascot.setAnimation(this.currentAnimation),this.requestID=window.requestAnimationFrame(this.update.bind(this))}update(t){const s=Math.min(t-this.lastUpdate,100)*.001;this.lastUpdate=t,this.velocity.y=this.velocity.y+this.acceleration_y*s;const n=this.mascot.canvas.position;n.y=n.y+this.velocity.y*s,n.x=n.x+this.velocity.x*s;const{status:a,newPosition:o}=this.mascot.environment.getCollisionStatus(n);if(a===u.None){this.mascot.flushPosition(),this.requestID=window.requestAnimationFrame(this.update.bind(this));return}n.x=o.x,n.y=o.y,a===u.Wall&&(this.currentAnimation.next=new P(this.velocity.x>0)),this.onStop()}onStop(){this.mascot.flushPosition(),this.mascot.setBehavior(new S),this.mascot.setAnimation(this.currentAnimation.next)}destroy(){this.mascot.canvas.canvas.removeEventListener("pointerdown",this.listener),window.cancelAnimationFrame(this.requestID)}handlePointerDown(t){this.mascot.canvas.setFrame("shime01.png"),this.mascot.setBehavior(new F({x:t.clientX,y:t.clientY}))}}function D(i,t,s){return Math.max(Math.min(i,s),t)}class C extends h{constructor(){super(...arguments);e(this,"name","idle fish");e(this,"requestID",0)}init(s){super.init(s),s.canvas.reversed=this.isRight,s.canvas.flushPosition()}destroy(){clearTimeout(this.requestID),this.mascot.canvas.reversed=!1,this.mascot.canvas.flushPosition()}generateNext(){this.next=new r,this.requestID=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},2e3)}getFrame(){return"shime20.png"}}class k extends h{constructor(){super(...arguments);e(this,"name","idle point");e(this,"requestID",0)}generateNext(){this.next=new r,this.requestID=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},1500)}getFrame(){return"shime37.png"}}class I extends h{constructor(){super(...arguments);e(this,"name","idle sits on tchat");e(this,"requestID",0);e(this,"secondFrame",0)}init(s){super.init(s),this.mascot.canvas.translateOffset.y=14,this.mascot.canvas.flushPosition(),this.secondFrame=window.setTimeout(()=>{this.mascot.canvas.setFrame("shime31.png")},1e3)}destroy(){super.destroy(),clearTimeout(this.requestID),clearTimeout(this.secondFrame),this.mascot.canvas.translateOffset.y=0,this.mascot.canvas.flushPosition()}generateNext(){this.next=this.getNextAnim(),this.requestID=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},f)}getFrame(){return"shime30.png"}getNextAnim(){return Math.random()>.5?new g:new j}}class j extends h{constructor(){super(...arguments);e(this,"name","idle sits tchat and move legs");e(this,"requestID",0);e(this,"intervalID",0);e(this,"destroyed",!1)}init(s){super.init(s),this.mascot.canvas.translateOffset.y=14,this.mascot.canvas.flushPosition();const n="31 32 31 33".split(" ");let a=0;this.intervalID=window.setInterval(()=>{this.destroyed||(this.mascot.canvas.setFrame(`shime${n[a]}.png`),a=(a+1)%n.length)},1500)}destroy(){this.destroyed=!0,clearTimeout(this.requestID),clearInterval(this.intervalID),this.mascot.canvas.translateOffset.y=0,this.mascot.canvas.flushPosition()}generateNext(){this.next=this.getNextAnim(),this.requestID=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},15e3)}getFrame(){return"shime33.png"}getNextAnim(){return new I}}class g extends h{constructor(){super(...arguments);e(this,"name","idle sits");e(this,"requestID",0)}generateNext(){this.next=this.getNextAnim(),this.requestID=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},f)}destroy(){super.destroy(),clearTimeout(this.requestID)}getFrame(){return"shime11.png"}getNextAnim(){if(Math.random()>.5)return new r;const s=[new z,new X,new $,new U,new I];return s[Math.floor(Math.random()*s.length)]}}class z extends h{constructor(){super(...arguments);e(this,"name","idle sits and bored");e(this,"requestID",0)}init(s){super.init(s),this.mascot.canvas.translateOffset.y=14,this.mascot.canvas.flushPosition()}destroy(){clearTimeout(this.requestID),this.mascot.canvas.translateOffset.y=0,this.mascot.canvas.flushPosition()}generateNext(){this.next=new g,this.requestID=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},f)}getFrame(){return"shime30.png"}}class X extends h{constructor(){super(...arguments);e(this,"name","idle sits and look up");e(this,"requestID",0)}destroy(){super.destroy(),clearTimeout(this.requestID)}generateNext(){this.next=new g,this.requestID=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},f)}getFrame(){return"shime26.png"}}class $ extends h{constructor(){super(...arguments);e(this,"name","idle sits and sing");e(this,"requestID",0);e(this,"animation",new w("16 17 16 17 27 15",1200))}init(s){super.init(s),this.animation.init(s)}destroy(){super.destroy(),this.animation.destroy(),clearTimeout(this.requestID)}generateNext(){this.next=new g,this.requestID=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},8200)}getFrame(){return"shime15.png"}}class U extends h{constructor(){super(...arguments);e(this,"name","idle sits and sticks tongue out");e(this,"requestID",0);e(this,"animation",new w("28 29 29 27",1e3))}init(s){super.init(s),this.animation.init(s)}destroy(){super.destroy(),this.animation.destroy(),clearTimeout(this.requestID)}generateNext(){this.next=new g,this.requestID=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},5e3)}getFrame(){return"shime27.png"}}class Y extends h{constructor(){super(...arguments);e(this,"name","idle smug");e(this,"animation",new w("39 40",500));e(this,"requestID",0)}init(s){super.init(s),this.animation.init(s)}destroy(){super.destroy(),this.animation.destroy()}generateNext(){this.next=new r,this.requestID=window.setTimeout(()=>{this.mascot.setAnimation(this.next)},1500)}getFrame(){return"shime38.png"}}const A=class{constructor(t=!1){e(this,"name","idle normal");e(this,"mascot");e(this,"next");e(this,"requestId",0);this.isRight=t}init(t){this.mascot=t,this.mascot.canvas.setFrame("shime1.png"),this.generateNext()}destroy(){clearTimeout(this.requestId)}generateNext(){if(Math.random()>A.jumpProbability){this.mascot.canvas.position.y-=20,this.mascot.canvas.flushPosition(),this.mascot.setBehavior(new v({x:Math.random()>.5?-30:30,y:-20}));return}this.next=this.getNextStandupAnim(),this.requestId=window.setTimeout(()=>{this.next&&this.mascot.setAnimation(this.next)},1e3)}getNextStandupAnim(){const t=[new Y,new k,new C(this.isRight),new I];return Math.random()>.75?new g:t[Math.floor(Math.random()*t.length)]}};let r=A;e(r,"jumpProbability",.8);const G=["shime01.png","shime1.png","shime2.png","shime3.png","shime4.png","shime5.png","shime6.png","shime7.png","shime8.png","shime9.png","shime10.png","shime11.png","shime12.png","shime13.png","shime14.png","shime15.png","shime16.png","shime17.png","shime18.png","shime19.png","shime20.png","shime21.png","shime22.png","shime23.png","shime24.png","shime25.png","shime26.png","shime27.png","shime28.png","shime29.png","shime30.png","shime31.png","shime32.png","shime33.png","shime34.png","shime35.png","shime36.png","shime37.png","shime38.png","shime39.png","shime40.png","shime41.png","shime42.png","shime43.png","shime44.png","shime45.png","shime46.png","enepoisson.png"];class W{constructor(){e(this,"image",{});e(this,"base",".");c.getInstance().isDiscord&&(this.base="https://logantann.github.io/discord-shimejis/")}async load(){const t=G.map(s=>new Promise((n,a)=>{const o=new Image;o.onload=()=>{n(o)},o.onerror=m=>{a(m)},o.src=`${this.base}/img/${s}`,this.image[s]=o}));await Promise.all(t)}get(t){if(!this.image[t])throw new Error(`image not found: ${t}`);return this.image[t]}}class b{constructor(t,s){e(this,"canvas");e(this,"ctx");e(this,"images");e(this,"position",{x:0,y:0});e(this,"translateOffset",{x:0,y:0});e(this,"reversed",!1);this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=s,this.canvas.setAttribute("class","ene-shimeji"),this.canvas.style.position="absolute",this.canvas.style.zIndex="101",this.updatePosition()}static async newInstance(t,s){const n=new b(128,128);return n.images=t,console.info("%c[shimejis]","font-weight: bold","Downloading images..."),await n.images.load(),console.info("%c[shimejis]","font-weight: bold","images loaded..."),s.appendChild(n.canvas),n.initContext(),n}initContext(){const t=this.canvas.getContext("2d");if(!t)throw new Error("canvas context not found");this.ctx=t}setFrame(t){const s=this.images.get(t);this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(s,0,0)}updatePosition(t=0,s=0){this.position.x=t,this.position.y=s,this.flushPosition()}flushPosition(){const{x:t,y:s}=this.position;let n=`translate(${t+this.translateOffset.x}px, ${s+this.translateOffset.y}px)`;this.reversed&&(n+=" scaleX(-1)"),this.canvas.style.transform=n}}class H{constructor(){e(this,"canvas");e(this,"container");e(this,"animation");e(this,"behavior");e(this,"environment",new L)}async start(){this.initContainer(),this.canvas=await b.newInstance(new W,this.container),this.environment.init(this),this.initMascotPosition()}stop(){var t;c.getInstance().detachEasterEgg(),this.animation&&this.animation.destroy(),this.behavior&&this.behavior.destroy(),(t=this.canvas)!=null&&t.canvas&&this.container.removeChild(this.canvas.canvas)}initContainer(){this.container=c.getInstance().getApp(),c.getInstance().attachEasterEgg(this.poissonMode.bind(this))}initMascotPosition(){this.canvas.position.x=this.environment.screenRects.width*.5-this.canvas.canvas.width*.5,this.flushPosition(),this.setBehavior(new v({x:0,y:0}))}setAnimation(t){this.animation&&this.animation.destroy(),this.animation=t,this.animation.init(this)}setBehavior(t){var s;((s=this.behavior)==null?void 0:s.name)!==t.name&&(this.behavior&&this.behavior.destroy(),this.behavior=t,this.behavior.init(this),this.canvas.canvas.dataset.behavior=this.behavior.name)}flushPosition(){const{top:t,left:s,right:n,bottom:a}=this.environment.screenRects,o={...this.canvas.position};return this.canvas.position.x<s-this.canvas.canvas.width*.5?(console.log("x < left",s,this.canvas.canvas.width*.5),this.canvas.position.x=s-this.canvas.canvas.width*.5):this.canvas.position.x>n-this.canvas.canvas.width*.5&&(this.canvas.position.x=n-this.canvas.canvas.width*.5),this.canvas.position.y<t?this.canvas.position.y=t:this.canvas.position.y+this.canvas.canvas.height>a&&(this.canvas.position.y=a-this.canvas.canvas.height),this.canvas.flushPosition(),o.x===this.canvas.position.x&&o.y===this.canvas.position.y}poissonMode(){r.jumpProbability=0,d.poissonMode=!0,this.setBehavior(new v({x:0,y:0}))}}class K{constructor(){e(this,"mascotInstance")}start(){console.info("%c[shimejis]","font-weight: bold","Starting plugin..."),this.mascotInstance=new H,this.mascotInstance.start()}stop(){var t;(t=this.mascotInstance)==null||t.stop(),console.info("%c[shimejis]","font-weight: bold","Plugin unloaded.")}}document.addEventListener("DOMContentLoaded",()=>{document.querySelector("section.title").addEventListener("click",()=>{document.querySelector("aside").classList.toggle("hidden")}),new K().start()});
